{% extends 'base.html' %}

{% block title %}<title>{{ user.last_name }} {{ user.first_name }}</title>{% endblock title %}

{% load static %}

{% block logo %}<img src="{% static 'images/orange-logo.png' %}" alt="Логотип YUTA">{% endblock logo %}

{% block content %}
    <div class="text-center avatar-block">
        <div class="container-xxl">
            <div class="avatar-wrapper">
                <img src="{{ user.cropped_photo.url }}" alt="аватарка">
                {% if is_owner %}
                    <button type="button" id="choiceAvatartBtn" data-bs-toggle="dropdown" aria-expanded="false">
                        <svg style="width: 40px; height: 40px;">
                            <use xlink:href="{% static 'images/svg/sprite.svg' %}#camera"></use>
                        </svg>
                    </button>
                    <ul class="dropdown-content">
                        <li>
                            <button class="dropdown-item d-flex gap-2 justify-content-start align-items-center"
                                    type="button" data-bs-toggle="modal" data-bs-target="#foto">
                                <svg style="width: 19px; height: 19px;">
                                    <use xlink:href="{% static 'images/svg/sprite.svg' %}#updatefoto"></use>
                                </svg>
                                <p>Обновить фотографию</p>
                            </button>
                        </li>
                        <li>
                            <button class="dropdown-item d-flex gap-2 justify-content-start align-items-center"
                                    type="button" id="openThumbModal">
                                <svg style="width: 19px; height: 19px;">
                                    <use xlink:href="{% static 'images/svg/sprite.svg' %}#crop"></use>
                                </svg>
                                <p>Изменить миниатюру</p>
                            </button>
                        </li>
                        <li>
                            <button class="dropdown-item d-flex gap-2 justify-content-start align-items-center"
                                    type="button" data-bs-toggle="modal" data-bs-target="#delete">
                                <svg style="width: 19px; height: 17px;">
                                    <use xlink:href="{% static 'images/svg/sprite.svg' %}#delete"></use>
                                </svg>
                                <p>Удалить фотографию</p>
                            </button>
                        </li>
                    </ul>
                {% endif %}
            </div>
            {% if is_owner %}
                <div class="modal fade modal-custom" id="foto" tabindex="-1" aria-labelledby="foto" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-lg">
                        <div class="modal-content">
                            <div class="modal-header position-relative">
                                <button type="button" class="close-modal-btn" data-bs-dismiss="modal"
                                        aria-label="Закрыть">
                                    <svg style="width: 28px; height: 28px;">
                                        <use xlink:href="{% static 'images/svg/sprite.svg' %}#close"></use>
                                    </svg>
                                </button>
                            </div>
                            <p class="modal-title text-center">Загрузка фотографии</p>
                            <div class="modal-devider"></div>
                            <form method="POST" enctype="multipart/form-data" class="mt-2">
                                {% csrf_token %}
                                <p class="text-center fs-5 mb-1">Друзьям будет проще узнать вас, если вы загрузите свою
                                    настоящую фотографию.</p>
                                <p class="text-center fs-5 mb-4">Вы можете загрузить изображение в формате JPG, GIF или
                                    PNG.</p>
                                <div class="input-file-row mb-3">
                                    <div class="d-flex gap-3 mb-3">
                                        <label class="input-file">
                                            <input type="file" id="inputImg" name="photo" multiple
                                                   accept="image/jpeg, image/jpg, image/png" required>
                                            <span>Выбрать фотографию</span>
                                        </label>
                                        <button type="button" id="deleteFotoBtn"
                                                class="d-flex justify-content-center align-items-center orange-btn modal-btn">
                                            <svg style="width: 19px; height: 17px;">
                                                <use xlink:href="{% static 'images/svg/sprite.svg' %}#delete"></use>
                                            </svg>
                                        </button>
                                    </div>
                                    <div class="input-file-list">
                                        <img src="{{ user.cropped_photo.url }}" data-src="{{ user.cropped_photo.url }}"
                                             id="output"/>
                                    </div>
                                </div>
                                <input type="hidden" name="action" value="update_photo">
                                <div class="d-flex flex-column justify-content-start gap-2">
                                    <button type="submit"
                                            class="d-flex gap-2 justify-content-center align-items-center orange-btn modal-btn">
                                        <svg style="width: 19px; height: 17px;">
                                            <use xlink:href="{% static 'images/svg/sprite.svg' %}#save"></use>
                                        </svg>
                                        <p>Сохранить</p>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal fade modal-custom" id="thumb" tabindex="-1" aria-labelledby="thumb"
                     aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-lg">
                        <div class="modal-content">
                            <div class="modal-header position-relative">
                                <button type="button" class="close-modal-btn" data-bs-dismiss="modal"
                                        aria-label="Закрыть">
                                    <svg style="width: 28px; height: 28px;">
                                        <use xlink:href="{% static 'images/svg/sprite.svg' %}#close"></use>
                                    </svg>
                                </button>
                            </div>
                            <p class="modal-title text-center">Выбор миниатюры</p>
                            <div class="modal-devider"></div>
                            <form method="POST" name="updateMiniatureForm" enctype="multipart/form-data" class="mt-2">
                                {% csrf_token %}
                                <p class="text-center fs-5 mb-1">Выберите область для маленьких фотографий.</p>
                                <p class="text-center fs-5 mb-4">Выбранная миниатюра будет использоваться в профиле.</p>

                                <div class="wrapperCrop d-flex justify-content-center align-items-sm-start">
                                    <div>
                                        <img src="{{ user.photo.url }}" id="imageCrop">
                                    </div>
                                    <div class="ms-lg-4 ms-md-0 ms-sm-0 ms-0 mt-lg-0 mt-md-3 mt-sm-3 mt-3">
                                        <div class="preview"></div>
                                    </div>
                                </div>

                                <input type="hidden" name="action" value="update_miniature">
                                <input type="hidden" name="width">
                                <input type="hidden" name="height">
                                <input type="hidden" name="delta_x">
                                <input type="hidden" name="delta_y">
                                <input type="hidden" name="container_width">
                                <input type="hidden" name="container_height">
                                <button type="submit" id="btnUpdateThumb" class="orange-btn modal-btn mt-5">
                                    Обновить
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal fade modal-custom" id="delete" tabindex="-1" aria-labelledby="delete"
                     aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header position-relative">
                                <button type="button" class="close-modal-btn" data-bs-dismiss="modal"
                                        aria-label="Закрыть">
                                    <svg style="width: 28px; height: 28px;">
                                        <use xlink:href="{% static 'images/svg/sprite.svg' %}#close"></use>
                                    </svg>
                                </button>
                            </div>
                            <p class="modal-title text-center">Предупреждение</p>
                            <div class="modal-devider"></div>
                            <form method="POST" class="mt-2">
                                {% csrf_token %}
                                <p class="text-start fs-5 my-3">Вы действительно хотите удалить фотографию?</p>
                                <input type="hidden" name="action" value="delete_photo">
                                <div class="d-flex justify-content-end mt-4">
                                    <button type="submit"
                                            class="d-flex gap-2 justify-content-center align-items-center orange-btn modal-btn">
                                        <svg style="width: 19px; height: 17px;">
                                            <use xlink:href="{% static 'images/svg/sprite.svg' %}#delete"></use>
                                        </svg>
                                        <p>Да, удалить</p>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
    <div class="container-xxl">
        <div class="position-relative text-center">
            {% if user.patronymic is not None %}
                <p class="person-name">{{ user.last_name }} {{ user.first_name }} {{ user.patronymic }}</p>
            {% else %}
                <p class="person-name">{{ user.last_name }} {{ user.first_name }}</p>
            {% endif %}
            <p class="person-age mt-2">{{ user.age }}</p>
            {% if user.biography is not None %}
                <p class="person-about mt-4">{{ user.biography }}</p>
            {% endif %}

            {% if is_owner %}
                <div class="person-icons">
                    <button type="button" data-bs-toggle="modal" data-bs-target="#edit">
                        <svg id="editButton" style="width: 30px; height: 30px;">
                            <use xlink:href="{% static 'images/svg/sprite.svg' %}#edit"></use>
                        </svg>
                    </button>
                    <div class="modal fade modal-custom" id="edit" tabindex="-1" aria-labelledby="Edit"
                         aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header position-relative">
                                    <button type="button" class="close-modal-btn" data-bs-dismiss="modal"
                                            aria-label="Закрыть">
                                        <svg style="width: 28px; height: 28px;">
                                            <use xlink:href="{% static 'images/svg/sprite.svg' %}#close"></use>
                                        </svg>
                                    </button>
                                </div>
                                <p class="modal-title text-center">Редактирование профиля</p>
                                <div class="modal-devider"></div>
                                <form method="POST" enctype="multipart/form-data" class="mt-2">
                                    {% csrf_token %}

                                    {% if user.biography is not None %}
                                        <div class="text-field__noticon mb-3">
                                            <textarea name="biography" maxlength="200"
                                                      placeholder="O cебе">{{ user.biography }}</textarea>
                                        </div>
                                    {% else %}
                                        <div class="text-field__noticon mb-3">
                                            <textarea name="biography" maxlength="200" placeholder="O cебе"></textarea>
                                        </div>
                                    {% endif %}

                                    {% if user.phone_number is not None %}
                                        <div class="text-field__noticon mb-3">
                                            <input type="text" class="phone" name="phone_number"
                                                   value="{{ user.phone_number }}" placeholder="Телефон">
                                        </div>
                                    {% else %}
                                        <div class="text-field__noticon mb-3">
                                            <input type="text" class="phone" name="phone_number" placeholder="Телефон">
                                        </div>
                                    {% endif %}

                                    {% if user.e_mail is not None %}
                                        <div class="text-field__noticon mb-3">
                                            <input type="text" name="e_mail" value="{{ user.e_mail }}"
                                                   placeholder="E-mail">
                                        </div>
                                    {% else %}
                                        <div class="text-field__noticon mb-3">
                                            <input type="text" name="e_mail" placeholder="E-mail">
                                        </div>
                                    {% endif %}

                                    {% if user.vk is not None %}
                                        <div class="text-field__noticon mb-3">
                                            <input type="text" name="vk" value="{{ user.vk }}"
                                                   placeholder="Ссылка на ВК">
                                        </div>
                                    {% else %}
                                        <div class="text-field__noticon mb-3">
                                            <input type="text" name="vk" placeholder="Ссылка на ВК">
                                        </div>
                                    {% endif %}

                                    <input type="hidden" name="action" value="edit_data">
                                    <div class="d-flex justify-content-end mt-4">
                                        <button type="submit"
                                                class="d-flex gap-2 justify-content-center align-items-center orange-btn modal-btn">
                                            <svg style="width: 19px; height: 17px;">
                                                <use xlink:href="{% static 'images/svg/sprite.svg' %}#save"></use>
                                            </svg>
                                            <p>Сохранить</p>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <button type="button" data-bs-toggle="modal" data-bs-target="#reload">
                        <svg id="reloadButton" style="width: 30px; height: 30px;">
                            <use xlink:href="{% static 'images/svg/sprite.svg' %}#reload"></use>
                        </svg>
                    </button>
                    <div class="modal fade modal-custom" id="reload" tabindex="-1" aria-labelledby="Reload"
                         aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header position-relative">
                                    <button type="button" class="close-modal-btn" data-bs-dismiss="modal"
                                            aria-label="Закрыть">
                                        <svg style="width: 28px; height: 28px;">
                                            <use xlink:href="{% static 'images/svg/sprite.svg' %}#close"></use>
                                        </svg>
                                    </button>
                                </div>
                                <p class="modal-title text-center">Обновление информации</p>
                                <div class="modal-devider"></div>
                                <p class="text-start fs-5 mt-2 mb-3">Чтобы синхронизировать данные личного кабинета на
                                    сайте ЯГТУ и данные в YUTA, введите свой пароль:</p>
                                <form method="POST" class="mt-2">
                                    {% csrf_token %}
                                    <div class="text-field__icon mb-3 text-field__icon_password">
                                        <input id="Password" type="password" name="password" placeholder="Пароль"
                                               maxlength="30">
                                        <input type="hidden" name="action" value="update_data">
                                    </div>
                                    {% if message %}
                                        <p>{{ message }}</p>
                                    {% endif %}
                                    <div class="d-flex justify-content-end mt-4">
                                        <button type="submit"
                                                class="d-flex gap-2 justify-content-center align-items-center orange-btn modal-btn">
                                            <svg style="width: 23px; height: 19px;">
                                                <use xlink:href="{% static 'images/svg/sprite.svg' %}#update"></use>
                                            </svg>
                                            <p>Обновить</p>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}

        </div>
        <div class="lk-devider my-4"></div>
        <div class="text-center study-info">
            <svg style="width: 60px; height: 60px;">
                <use xlink:href="{% static 'images/svg/sprite.svg' %}#study"></use>
            </svg>
            <p>Факультет: {{ user.faculty.name }}</p>
            <p>Направление: {{ user.direction.code }} - {{ user.direction.name }}</p>
            <p>Группа: {{ user.group.name }}</p>
        </div>
        <div class="statistic d-flex align-items-center justify-content-center">
            <div class="statistic-item text-center animate__animated animate__fadeInUp animate__faster">
                <p class="item-title">Проекты</p>
                <p class="item-meaning">{{ user.done_projects_count }}/{{ user.all_projects_count }}</p>
            </div>
            <div class="statistic-item text-center wow animate__animated animate__fadeInUp animate__faster"
                 data-wow-delay="0.2s">
                <p class="item-title">Задачи</p>
                <p class="item-meaning">{{ user.done_tasks_count }}/{{ user.all_tasks_count }}</p>
            </div>
            <div class="statistic-item text-center wow animate__animated animate__fadeInUp animate__faster"
                 data-wow-delay="0.4s">
                <p class="item-title">Команды</p>
                <p class="item-meaning">{{ user.teams_count }}</p>
            </div>
        </div>

        <div class="contacts d-flex align-items-center justify-content-center">

            {% if user.phone_number is not None %}
                <div class="contacts-item d-flex align-items-center justify-content-center">
                    <svg>
                        <use xlink:href="{% static 'images/svg/sprite.svg' %}#phone"></use>
                    </svg>
                    <p>{{ user.phone_number }}</p>
                </div>
            {% endif %}

            {% if user.e_mail is not None %}
                <div class="contacts-item d-flex align-items-center justify-content-center">
                    <svg>
                        <use xlink:href="{% static 'images/svg/sprite.svg' %}#message"></use>
                    </svg>
                    <p>{{ user.e_mail }}</p>
                </div>
            {% endif %}

            {% if user.vk is not None %}
                <div class="contacts-item d-flex align-items-center justify-content-center">
                    <svg>
                        <use xlink:href="{% static 'images/svg/sprite.svg' %}#vk"></use>
                    </svg>
                    <p><a href="{{ user.vk }}">{{ user.vk }}</a></p>
                </div>
            {% endif %}

        </div>
    </div>
{% endblock content %}